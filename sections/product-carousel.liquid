<div class="main-section">
  <div class="section-heading">
    <h2>{{ section.settings.heading }}</h2>
    {% if section.settings.link != blank %}
      <a href="{{ section.settings.link }}" class="section-link">{{ section.settings.link_text }}</a>
    {% endif %}
  </div>

  {% assign products = collections[section.settings.collection].products | limit: section.settings.product_limit %}
  {% if products.size == 0 %}
    <div class="carousel-wrapper" style="text-align: center; padding: 50px;">
      <p>No products found in this collection.</p>
    </div>
  {% else %}
    <product-carousel 
      class="carousel-wrapper" 
      aria-label="{{ section.settings.heading }} carousel"
      data-infinite="{{ section.settings.infinite_loop }}"
      data-autoplay="{{ section.settings.autoplay_interval }}"
    >
      <button class="carousel-control left" aria-label="Previous products" disabled>‹</button>

      <div class="carousel-window" role="region" aria-live="polite">
        <div class="carousel-inner">
          {% for product in products %}
            <div class="product-item" role="group" aria-label="{{ product.title | escape }}">
              <div class="product-photo">
                {% if product.compare_at_price > product.price %}
                  <span class="product-label">30% OFF GIFT SETS</span>
                {% elsif product.tags contains 'bestseller' %}
                  <span class="product-label">BEST SELLER</span>
                {% endif %}

                <a href="{{ product.url }}">
                  {% render 'product-image', product: product %}
                </a>
              </div>

              <div class="product-details">
                <div class="product-title">
                  <a href="{{ product.url }}">{{ product.title }}</a>
                </div>
                <div class="product-cost">{{ product.price | money }}</div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>

      <button class="carousel-control right" aria-label="Next products" disabled>›</button>
    </product-carousel>
  {% endif %}
</div>

{% schema %}
{
  "name": "Product Carousel",
  "class": "section-product-carousel",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "GIFT SETS"
    },
    {
      "type": "url",
      "id": "link",
      "label": "Browse all link"
    },
    {
      "type": "text",
      "id": "link_text",
      "label": "Browse all text",
      "default": "Browse all"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection to display"
    },
    {
      "type": "range",
      "id": "product_limit",
      "min": 6,
      "max": 20,
      "step": 1,
      "default": 12,
      "label": "Maximum products to show"
    },
    {
      "type": "checkbox",
      "id": "infinite_loop",
      "label": "Enable infinite loop",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_interval",
      "min": 0,
      "max": 10000,
      "step": 500,
      "unit": "ms",
      "label": "Autoplay interval (0 = off)",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "Product Carousel"
    }
  ]
}
{% endschema %}